# 📊 Агрегация ТОЛЬКО для Excel экспорта

## 📋 Архитектура

```
UI (Приложение)
    ↓
ВСЕГДА детальная агрегация (9 полей)
    ↓
Таблица показывает ВСЕ строки как есть
    ↓
Excel экспорт
    ↓
ОПЦИОНАЛЬНО: дополнительная группировка (6 полей)
    ↓
Файл сохраняется с выбранным типом
```

---

## 🎯 Как работает

### В UI (Таблице)
**ВСЕГДА** показываются детальные данные (группировка по 9 полям):
```
Объект | Договор | Система | Подсистема | Участок | Этаж | № позиции | Наименование | Ед. изм.
Дом А  | Д-1    | ВК     | Электро    | Зал 1  | 1    | 1.1      | Монтаж       | м
Дом А  | Д-1    | ВК     | Электро    | Зал 2  | 1    | 1.1      | Монтаж       | м ← разные этажи
```

### При экспорте в Excel
**ОПЦИОНАЛЬНО** можно применить дополнительную группировку:

**Диалог экспорта:**
```
┌─────────────────────────────────┐
│ Экспорт в Excel                 │
├─────────────────────────────────┤
│ Выберите колонки:               │
│ ☑ Объект                        │
│ ☑ Договор                       │
│ ☑ Система                       │
│ ☑ Подсистема                    │
│ ☑ Участок                       │
│ ☑ Этаж                          │
│ ☑ № позиции                     │
│ ☑ Наименование                  │
│ ☑ Ед. изм.                      │
│ ☑ Кол-во                        │
│ ☑ Цена                          │
│ ☑ Сумма                         │
│                                 │
│ ─────────────────────────────── │
│ ☐ Дополнительная группировка    │
│   Только объект + договор +     │
│   система + подсистема + работа │
│                                 │
│        [Отмена] [Экспорт]       │
└─────────────────────────────────┘
```

**Без дополнительной группировки** (по умолчанию):
```
Объект | Договор | Система | Подсистема | Участок | Этаж | № | Наименование | ...
Дом А  | Д-1    | ВК     | Электро    | Зал 1  | 1    | 1 | Монтаж       |
Дом А  | Д-1    | ВК     | Электро    | Зал 2  | 1    | 1 | Монтаж       | ← обе строки
```

**С дополнительной группировкой** (если включить toggle):
```
Объект | Договор | Система | Подсистема | № | Наименование | Кол | Цена | Сумма
Дом А  | Д-1    | ВК     | Электро    | 1 | Монтаж       | 8   | 100  | 800    ← объединены!
```

---

## 🔧 Как выбрать

### ШАГ 1: Нажми "📥 Экспорт" в AppBar
```
┌──────────────────────────────────┐
│ [🔙] Выгрузка данных      [📅][🔧][📥]
└──────────────────────────────────┘
                              ↑ Здесь
```

### ШАГ 2: В диалоге переключи toggle
```
☐ Дополнительная группировка
```

### ШАГ 3: Нажми "Экспорт"

---

## ✅ Ключевые отличия

| Что | До | Сейчас |
|-----|-----|--------|
| UI таблица | Разные уровни (toggle) | ВСЕГДА детальная (9 полей) |
| Excel опция | В меню фильтров | В диалоге экспорта |
| Выбор | Влияет на UI | Влияет только на Excel |
| Логика | Сложная | Простая ✅ |

---

## 💾 Примеры файлов

### Вариант 1: По умолчанию (без дополнительной группировки)
**Что выбрать:** Просто нажимаешь "Экспорт" (toggle выключен)

**Результат:**
```
Дом А, Д-1, ВК, Электро, Зал 1, 1, 1.1, Монтаж, м, 5, 100, 500
Дом А, Д-1, ВК, Электро, Зал 2, 1, 1.1, Монтаж, м, 3, 100, 300  ← разные
Дом А, Д-1, ВК, Электро, Зал 1, 2, 1.2, Проводка, м, 10, 50, 500
```

### Вариант 2: С дополнительной группировкой
**Что выбрать:** Включаешь toggle перед "Экспорт"

**Результат:**
```
Дом А, Д-1, ВК, Электро, 1.1, Монтаж, 8, 100, 800  ← объединены!
Дом А, Д-1, ВК, Электро, 1.2, Проводка, 10, 50, 500
```

---

## ⚡ Преимущества

✅ **Просто:** Выбор влияет только на Excel, UI не меняется  
✅ **Понятно:** Пользователь видит в диалоге что именно произойдёт  
✅ **Гибко:** Можно выбрать в последний момент  
✅ **Чисто:** Нет лишних кнопок в основном интерфейсе  

