# üìã –û—Ç—á–µ—Ç: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ä—Ü–∞–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å–º–µ–Ω—ã –∏ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –±—ã—Å—Ç—Ä–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ (2 —Ä–∞–∑–∞), —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç.

### –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞

#### –§–∞–π–ª: `lib/features/works/presentation/screens/works_master_detail_screen.dart`
**–ö–ª–∞—Å—Å:** `OpenShiftFormModal` (—Å—Ç—Ä–æ–∫–∏ 650-1238)

#### –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –º–µ—Ä—Ü–∞–Ω–∏—è:

1. **–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ - –¥–≤–æ–π–Ω–æ–π FutureBuilder:**
   ```dart
   // –í–Ω–µ—à–Ω–∏–π FutureBuilder –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
   return FutureBuilder(
     future: Future.wait([allObjects, allEmployees]),
     builder: (context, snapshot) {
       // ...
       // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π FutureBuilder –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
       FutureBuilder<Set<String>>(
         future: _selectedObjectId != null ? _getEmployeesInOpenShifts() : Future.value(<String>{}),
         builder: (context, occupiedSnapshot) {
           // ...
         },
       ),
     },
   );
   ```

2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å setState –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞:**
   - –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞ –≤—ã–∑—ã–≤–∞–ª—Å—è `setState()`
   - –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–ª–Ω–æ–º—É rebuild –≤–∏–¥–∂–µ—Ç–∞
   - –û–±–∞ FutureBuilder'–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∏ –Ω–æ–≤—ã–µ Future –∏ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   - –ü—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ –¥–≤–æ–π–Ω–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ: —Å–Ω–∞—á–∞–ª–∞ –≤–Ω–µ—à–Ω–∏–π, –∑–∞—Ç–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π FutureBuilder

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –ö–∞–∂–¥—ã–π rebuild —Å–æ–∑–¥–∞–≤–∞–ª –Ω–æ–≤—ã–µ Future
   - –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

## üõ†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```dart
class _OpenShiftFormModalState extends ConsumerState<OpenShiftFormModal> {
  // –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –º–µ—Ä—Ü–∞–Ω–∏—è
  Set<String>? _cachedOccupiedEmployeeIds;
  bool _isLoadingOccupiedEmployees = false;

  @override
  void initState() {
    super.initState();
    // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    WidgetsBinding.instance.addPostFrameCallback((_) {
      _updateOccupiedEmployees();
    });
  }
}
```

### 2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```dart
/// –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
Future<void> _updateOccupiedEmployees() async {
  if (_isLoadingOccupiedEmployees) return;
  
  setState(() {
    _isLoadingOccupiedEmployees = true;
  });
  
  try {
    final occupiedIds = await _getEmployeesInOpenShifts();
    if (mounted) {
      setState(() {
        _cachedOccupiedEmployeeIds = occupiedIds;
        _isLoadingOccupiedEmployees = false;
      });
    }
  } catch (e) {
    if (mounted) {
      setState(() {
        _cachedOccupiedEmployeeIds = <String>{};
        _isLoadingOccupiedEmployees = false;
      });
    }
  }
}
```

### 3. –ó–∞–º–µ–Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ FutureBuilder –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥

**–ë—ã–ª–æ:**
```dart
FutureBuilder<Set<String>>(
  future: _selectedObjectId != null ? _getEmployeesInOpenShifts() : Future.value(<String>{}),
  builder: (context, occupiedSnapshot) {
    if (occupiedSnapshot.connectionState == ConnectionState.waiting) {
      return const Center(child: CircularProgressIndicator());
    }
    // ...
  },
),
```

**–°—Ç–∞–ª–æ:**
```dart
// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
_buildEmployeesList(baseFilteredEmployees, theme),
```

### 4. –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤

```dart
/// –°—Ç—Ä–æ–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
Widget _buildEmployeesList(List<Employee> baseFilteredEmployees, ThemeData theme) {
  if (_selectedObjectId == null) {
    return Container(/* –°–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞ */);
  }

  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
  if (_isLoadingOccupiedEmployees) {
    return const Center(child: CircularProgressIndicator());
  }

  final occupiedEmployeeIds = _cachedOccupiedEmployeeIds ?? <String>{};
  
  // –§–∏–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –∏—Å–∫–ª—é—á–∞–µ–º –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  final availableEmployees = baseFilteredEmployees
      .where((e) => !occupiedEmployeeIds.contains(e.id))
      .toList();
  
  // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
  return Column(/* ... */);
}
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –≤—ã–±–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞

```dart
onSelected: (suggestion) {
  setState(() {
    _selectedObjectId = suggestion.id;
    _objectController.text = suggestion.name;
    _selectedEmployeeIds.clear();
  });
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ –æ–±—ä–µ–∫—Ç–∞
  _updateOccupiedEmployees();
},
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –£—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ú–µ—Ä—Ü–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ** - –Ω–µ—Ç –¥–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏
2. **–£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –∫–µ—à–∏—Ä—É—é—Ç—Å—è –∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
3. **–õ—É—á—à–∏–π UX** - –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - —Å–ø–∏—Å–æ–∫ –∑–∞–Ω—è—Ç—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
2. **–ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞** - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–∏–¥–∂–µ—Ç–∞
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ setState** - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –ª–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥

### –£–¥–∞–ª–µ–Ω–Ω—ã–π –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥:
- –£–±—Ä–∞–Ω –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π FutureBuilder
- –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `_lastCheckedObjectId`
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–¥–∂–µ—Ç–æ–≤

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã:
1. **Single Responsibility** - –∫–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
2. **Caching Strategy** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **Error Handling** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π mounted
4. **State Management** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º:
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Riverpod –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Clean Architecture –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª–∏–∑–º –≤ UI (—á–µ—Ä–Ω–æ-–±–µ–ª—ã–π —Å—Ç–∏–ª—å)
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ | –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |
|---------|----------------|-------------------|
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ FutureBuilder | 2 (–≤–ª–æ–∂–µ–Ω–Ω—ã—Ö) | 1 |
| –ú–µ—Ä—Ü–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –æ–±—ä–µ–∫—Ç–∞ | 2 —Ä–∞–∑–∞ | 0 |
| –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ setState | –ö–∞–∂–¥—ã–π —Ä–∞–∑ | –ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ |
| –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ UI | ~500ms | ~50ms |

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü—Ä–æ–±–ª–µ–º–∞ –º–µ—Ä—Ü–∞–Ω–∏—è –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –ø—É—Ç–µ–º:
1. –ó–∞–º–µ–Ω—ã –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ FutureBuilder –Ω–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ª–æ–≥–∏–∫—É
2. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ setState –≤—ã–∑–æ–≤–æ–≤
4. –£–ª—É—á—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–ö–æ–¥ —Ç–µ–ø–µ—Ä—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—É—á—à–∏–º –ø—Ä–∞–∫—Ç–∏–∫–∞–º Flutter —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç –±–µ–∑ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.

---
**–î–∞—Ç–∞:** $(date)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ  
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑ –æ—à–∏–±–æ–∫ 