# üìä –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –º–æ–¥—É–ª–µ Export

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
**–§–∞–π–ª:** `lib/features/export/domain/usecases/aggregate_reports.dart`

–°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `aggregateReports()` –∫–æ—Ç–æ—Ä–∞—è –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç—ã –ø–æ:
- –û–±—ä–µ–∫—Ç
- –î–æ–≥–æ–≤–æ—Ä
- –°–∏—Å—Ç–µ–º–∞
- –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
- –£—á–∞—Å—Ç–æ–∫ (section)
- –≠—Ç–∞–∂ (floor)
- ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
- –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
- –ï–¥. –∏–∑–º.

**–õ–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
- ‚úÖ –°—É–º–º–∏—Ä—É—é—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ (`quantitySum`)
- ‚úÖ –¶–µ–Ω–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –µ—Å–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è, –∏–Ω–∞—á–µ `null`
- ‚úÖ –°—É–º–º–∏—Ä—É–µ—Ç—Å—è –∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ (`totalSum`)
- ‚úÖ –ë–µ—Ä—ë—Ç—Å—è –ø–µ—Ä–≤–∞—è –¥–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã
- ‚úÖ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ –∏ —á–∞—Å—ã –æ—á–∏—â–∞—é—Ç—Å—è (`null`)

---

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤ Repository
**–§–∞–π–ª:** `lib/features/export/data/repositories/export_repository_impl.dart`

```dart
@override
Future<List<ExportReport>> getExportData(ExportFilter filter) async {
  final filterModel = _mapFilterToModel(filter);
  final reportModels = await dataSource.getExportData(filterModel);
  final reports = reportModels.map(_mapReportModelToEntity).toList();
  // ‚úÖ –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º
  return aggregateReports(reports);
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤ UI –∏ —ç–∫—Å–ø–æ—Ä—Ç–µ.

---

### 3. –£–ø—Ä–æ—â–µ–Ω–∏–µ ExportService
**–§–∞–π–ª:** `lib/features/export/presentation/services/export_service.dart`

- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (`_AggregatedEntry`)
- ‚ùå –£–¥–∞–ª—ë–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `aggregate` –∏–∑ `exportToExcel()`
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –ø—Ä–æ—Å—Ç–æ –≤—ã–≥—Ä—É–∂–∞–µ—Ç —É–∂–µ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ë—ã–ª–æ:** 369 —Å—Ç—Ä–æ–∫ —Å –¥—É–±–ª–∏—Ä—É—é—â–µ–π—Å—è –ª–æ–≥–∏–∫–æ–π  
**–°—Ç–∞–ª–æ:** 221 —Å—Ç—Ä–æ–∫–∞ (–æ—á–∏—â–µ–Ω–Ω—ã–π –∫–æ–¥)

---

### 4. –£–ø—Ä–æ—â–µ–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
**–§–∞–π–ª:** `lib/features/export/presentation/widgets/export_excel_action.dart`

- ‚ùå –£–¥–∞–ª–µ–Ω toggle "–û–±—ä–µ–¥–∏–Ω—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏"
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `savedAggregate`
- ‚úÖ –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–æ–∫

---

### 5. –ß–∏—Å—Ç–∫–∞ ExportTableWidget
**–§–∞–π–ª:** `lib/features/export/presentation/widgets/export_table_widget.dart`

- ‚ùå –£–¥–∞–ª–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–∏—Å–∫–∞ (–¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∏—Å–∫ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
- ‚úÖ –û—Å—Ç–∞–ª–∞—Å—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–∂–µ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üîÑ –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (–Ω–æ–≤—ã–π)

```
Supabase (work_items)
    ‚Üì
ExportDataSourceImpl.getExportData()
    ‚Üì –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç RAW –¥–∞–Ω–Ω—ã–µ
ExportRepositoryImpl.getExportData()
    ‚Üì üî¥ aggregateReports() ‚Üê –ê–ì–†–ï–ì–ê–¶–ò–Ø –¢–£–¢
    ‚Üì –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
ExportProvider (state.reports)
    ‚Üì –£–∂–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
ExportTabReports / ExportTableWidget
    ‚Üì –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
```

---

## üìã –ö–ª—é—á–µ–≤—ã–µ —Ç–æ—á–∫–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ë—ã–ª–æ | –°—Ç–∞–ª–æ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|-----------|------|-------|-----------|
| ExportService | 369 —Å—Ç—Ä–æ–∫ | 221 —Å—Ç—Ä–æ–∫ | -148 —Å—Ç—Ä–æ–∫ ‚úÖ |
| ExportExcelAction | –î–∏–∞–ª–æ–≥ + toggle | –¢–æ–ª—å–∫–æ –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ | –£–ø—Ä–æ—â–µ–Ω–æ ‚úÖ |
| ExportTableWidget | –ü–æ–∏—Å–∫ + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –¢–æ–ª—å–∫–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ | –£–ø—Ä–æ—â–µ–Ω–æ ‚úÖ |
| –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ | –î–∞ (2 –º–µ—Å—Ç–∞) | –ù–µ—Ç | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ |

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ï–¥–∏–Ω–∞—è –ª–æ–≥–∏–∫–∞** ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ (domain/usecases)
2. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–µ–∑–¥–µ (UI –∏ Excel)
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
4. **–ß–∏—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞** ‚Äî —É–±—Ä–∞–Ω–æ 148 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
5. **Maintainability** ‚Äî –ª–µ–≥—á–µ –º–µ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

---

## üîß –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–æ–ª—è–º

```dart
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –ø–æ —ç—Ç–∏–º 9 –ø–æ–ª—è–º:
[
  objectName,           // –û–±—ä–µ–∫—Ç
  contractName,         // –î–æ–≥–æ–≤–æ—Ä  
  system,              // –°–∏—Å—Ç–µ–º–∞
  subsystem,           // –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
  section,             // –£—á–∞—Å—Ç–æ–∫
  floor,               // –≠—Ç–∞–∂
  positionNumber,      // ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
  workName,            // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
  unit,                // –ï–¥. –∏–∑–º.
].join('||')
```

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

- ‚úÖ –§—É–Ω–∫—Ü–∏—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –≤ Repository
- ‚úÖ ExportService —É–ø—Ä–æ—â—ë–Ω
- ‚úÖ UI –æ—á–∏—â–µ–Ω
- ‚úÖ Freezed —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –ù–µ—Ç linter –æ—à–∏–±–æ–∫
