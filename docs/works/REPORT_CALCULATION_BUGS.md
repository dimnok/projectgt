# üîç –ü–ï–†–ï–ê–ù–ê–õ–ò–ó: –û—à–∏–±–∫–∏ —Ä–∞—Å—á—ë—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω–æ–º —ç–∫—Ä–∞–Ω–µ

**–î–∞—Ç–∞:** 17 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üî¥ –û–ë–ù–ê–†–£–ñ–ï–ù–´ –î–í–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò

---

## ‚ö†Ô∏è –û–®–ò–ë–ö–ê 1: –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Å–º–µ–Ω - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ì–†–£–ü–ü–ò–†–û–í–ö–ê –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (export_data_source_impl.dart, —Å—Ç—Ä–æ–∫–∏ 121-150)

```dart
// –®–ê–ì 1: –ü–æ–ª—É—á–∞–µ–º –í–°–ï work_items –∏–∑ –ë–î —Å –¥–∞—Ç–æ–π
// SELECT date, work_items.*, estimates.*, contracts.* 
// FROM works JOIN work_items ... WHERE date BETWEEN dateFrom AND dateTo
// –†–µ–∑—É–ª—å—Ç–∞—Ç: List<ExportReportModel> —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω–æ–π –¥–∞—Ç–æ–π (workDate)

// –®–ê–ì 2: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê - –≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ë–ï–ó –î–ê–¢–´!
final groupKey = '${report.objectName}_'
    '${report.contractName}_'
    '${report.system}_'
    '${report.subsystem}_'
    '${report.positionNumber}_'
    '${report.workName}_'
    '${report.section}_'
    '${report.floor}_'
    '${report.unit}_'
    '${report.price ?? 0}';
    
// ‚ö†Ô∏è –î–ê–¢–ê –ù–ï –í–•–û–î–ò–¢ –í –ö–õ–Æ–ß! –≠—Ç–æ –∑–Ω–∞—á–∏—Ç:
// –û–¥–Ω–∞ –∏ —Ç–∞ –∂–µ —Ä–∞–±–æ—Ç–∞ –≤ —Ä–∞–∑–Ω—ã–µ –¥–Ω–∏ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–¥–Ω–æ–π!
```

### –ü—Ä–∏–º–µ—Ä –æ—à–∏–±–∫–∏:

```
–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ date    ‚îÇ name ‚îÇ quantity      ‚îÇ total       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 2025-10-01 ‚îÇ –ö–∞–±–µ–ª—å ‚îÇ 10 –º  ‚îÇ 1000 ‚ÇΩ  ‚îÇ  ‚Üê –ü–ï–†–í–´–ô –î–ï–ù–¨
‚îÇ 2025-10-02 ‚îÇ –ö–∞–±–µ–ª—å ‚îÇ 20 –º  ‚îÇ 2000 ‚ÇΩ  ‚îÇ  ‚Üê –í–¢–û–†–û–ô –î–ï–ù–¨
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
key = "–û–±—ä–µ–∫—Ç_–î–æ–≥–æ–≤–æ—Ä_–°–∏—Å—Ç–µ–º–∞_..._–ö–∞–±–µ–ª—å_..."
–î–í–ï –†–ê–ó–ù–´–ï –∑–∞–ø–∏—Å–∏ ‚Üí –û–î–ù–ê –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:

‚ùå ExportReport {
  workDate: 2025-10-01  // ‚Üê –û–°–¢–ê–ù–ï–¢–°–Ø –ü–ï–†–í–ê–Ø –î–ê–¢–ê!
  quantity: 30 –º        // ‚Üê –°–£–ú–ú–ê–†–ù–û–ï (10 + 20)
  total: 3000 ‚ÇΩ         // ‚Üê –°–£–ú–ú–ê–†–ù–´–ô TOTAL
}

–†–µ–∑—É–ª—å—Ç–∞—Ç: –í—Å–µ —Å–º–µ–Ω—ã –∑–∞ 01.10 –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç 3000 ‚ÇΩ
–ê –≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- 01.10: 1000 ‚ÇΩ  
- 02.10: 2000 ‚ÇΩ
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ?

```dart
// –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (shifts_calendar_widgets.dart, —Å—Ç—Ä–æ–∫–∏ 144-148):
for (final r in reports) {
  if (r.workDate.year == now.year && r.workDate.month == now.month) {
    final d = DateTime(r.workDate.year, r.workDate.month, r.workDate.day);
    final total = (r.total ?? 0).toDouble();
    sumByDate[d] = (sumByDate[d] ?? 0) + total;  // ‚Üê –°–£–ú–ú–ò–†–£–ï–¢ –£–ñ–ï –ê–ì–†–ï–ì–ò–†–û–í–ê–ù–ù–´–ï –ó–ù–ê–ß–ï–ù–ò–Ø!
  }
}

–ï—Å–ª–∏ –ø—Ä–∏–ª–µ—Ç–µ–ª–∞ –æ–¥–Ω–∞ –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —Å total=3000 –∏ workDate=01.10:
‚úÖ sumByDate[01.10] = 3000  // –í–µ—Ä–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞ 01.10
‚ùå –í–°–ï –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–Ω–∏ - –Ω–µ –≤–∏–¥–Ω—ã!  // –ó–∞ 02.10 –±—É–¥–µ—Ç 0!
```

### –†–µ—à–µ–Ω–∏–µ

```dart
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –≤–∫–ª—é—á–∏—Ç—å –î–ê–¢–£ –≤ –∫–ª—é—á –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
final groupKey = '${report.workDate}_'  // ‚Üê –î–û–ë–ê–í–ò–¢–¨ –î–ê–¢–£!
    '${report.objectName}_'
    '${report.contractName}_'
    ...
```

---

## ‚ùå –û–®–ò–ë–ö–ê 2: –î–æ–≥–æ–≤–æ—Ä—ã - –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JOIN –≤ –∑–∞–ø—Ä–æ—Å–µ

### –§–∞–π–ª
`lib/features/home/presentation/widgets/contract_progress_widget.dart` (—Å—Ç—Ä–æ–∫–∏ 72-74)

### –¢–µ–∫—É—â–∏–π –∫–æ–¥ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô)
```dart
// –ó–∞–ø—Ä–æ—Å 2: –í—ã–ø–æ–ª–Ω–µ–Ω–æ –ø–æ —Ä–∞–±–æ—Ç–∞–º
final workItemsResp = await client
    .from('work_items')
    .select('total, quantity, price, estimates!inner(contract_id)');
    // ‚ö†Ô∏è –û–®–ò–ë–ö–ê: –ù–ï–¢ –§–ò–õ–¨–¢–†–ê –ü–û CONTRACT_ID!
```

### –ü—Ä–æ–±–ª–µ–º–∞
**–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –í–°–ï work_items –∏–∑ –ë–î –ë–ï–ó —Ñ–∏–ª—å—Ç—Ä–∞!**

- ‚ùå SELECT * FROM work_items JOIN estimates (–±–µ–∑ WHERE!)
- ‚ùå –ï—Å–ª–∏ –≤ –ë–î 10000 work_items - –∑–∞–≥—Ä—É–∑–∏–º –≤—Å–µ 10000!
- ‚ùå –°—á–∏—Ç–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –î–õ–Ø –í–°–ï–• –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –≤–º–µ—Å—Ç–µ

### –†–µ—à–µ–Ω–∏–µ

```dart
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –° –§–ò–õ–¨–¢–†–û–ú
final workItemsResp = await client
    .from('work_items')
    .select('total, quantity, price, estimates!inner(contract_id)')
    .not('estimates.contract_id', 'is', null);
```

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –û—à–∏–±–∫–∞ | –¢–∏–ø | –í–ª–∏—è–Ω–∏–µ | –ò—Å—Ç–æ—á–Ω–∏–∫ |
|--------|:---:|---------|----------|
| **–ö–∞–ª–µ–Ω–¥–∞—Ä—å** | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ë–ï–ó –¥–∞—Ç—ã | üî¥ –°—É–º–º–∏—Ä—É–µ—Ç —Ä–∞–∑–Ω—ã–µ –¥–Ω–∏ –≤ –æ–¥–∏–Ω | `export_data_source_impl.dart` (—Å—Ç—Ä–æ–∫–∞ 125) |
| **–î–æ–≥–æ–≤–æ—Ä—ã** | –ó–∞–ø—Ä–æ—Å –±–µ–∑ WHERE | üî¥ –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ 10K+ –∑–∞–ø–∏—Å–µ–π | `contract_progress_widget.dart` (—Å—Ç—Ä–æ–∫–∞ 74) |

---

## üîß –ß–ï–ö-–õ–ò–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

- [ ] **–ö–∞–ª–µ–Ω–¥–∞—Ä—å:** –î–æ–±–∞–≤–∏—Ç—å `${report.workDate}_` –≤ –Ω–∞—á–∞–ª–æ groupKey (—Å—Ç—Ä–æ–∫–∞ 125)
- [ ] **–î–æ–≥–æ–≤–æ—Ä—ã:** –î–æ–±–∞–≤–∏—Ç—å `.not('estimates.contract_id', 'is', null)` (–ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ 74)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞ –¥–Ω–∏ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ —Ä–∞–±–æ—Ç–∞–º–∏
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä—ã –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤  
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö
