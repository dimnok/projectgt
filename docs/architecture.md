# Архитектура ProjectGT

## Общая структура

ProjectGT построен на принципах **Clean Architecture** с четким разделением ответственности между слоями:

```
lib/
├── core/          # Общие компоненты, DI, утилиты
├── data/          # Реализация репозиториев и источников данных
├── domain/        # Бизнес-сущности, интерфейсы репозиториев, use cases
├── features/      # Функциональность приложения по фичам
└── presentation/  # UI компоненты и состояния
```

## Слои архитектуры

### Domain

Независимый слой с бизнес-логикой, не содержащий зависимостей от внешних слоев.

- `domain/entities/` - бизнес-сущности (User, Profile)
- `domain/repositories/` - интерфейсы репозиториев
- `domain/usecases/` - конкретные бизнес-операции

### Data

Реализация доступа к данным и внешним источникам.

- `data/datasources/` - источники данных (Supabase)
- `data/models/` - модели данных с сериализацией/десериализацией
- `data/repositories/` - реализации интерфейсов из domain

### Presentation

UI-компоненты и управление состоянием.

- `presentation/state/` - провайдеры состояния (Riverpod)
- `presentation/theme/` - стили и темы
- `presentation/widgets/` - переиспользуемые виджеты

### Features

Организация кода по функциональным модулям:

- `features/auth/` - аутентификация
- `features/home/` - главный экран
- `features/profile/` - профиль пользователя
- `features/employees/` — модуль сотрудников. Реализует формы с четкой структурой (основная информация, физические параметры, трудоустройство, паспортные данные, документы) и поддержкой всех бизнес-полей, необходимых для кадрового учета.
  - Для связи сотрудника с объектами используется поле `objectIds: List<String>`. В форме реализован мультивыбор объектов с помощью выпадающего списка (DropDownTextField.multiSelection), выбранные объекты отображаются только внутри поля выбора, без стикеров.
- `features/objects/` — модуль объектов. Реализует список, просмотр, создание и редактирование объектов. Форма создания/редактирования вынесена в отдельный stateless-виджет (`ObjectFormContent`), для модального окна используется отдельный stateful-виджет (`ObjectFormModal`), который управляет состоянием и сохранением через Provider. Такой подход унифицирует UX с модулем сотрудников и предотвращает архитектурные ошибки (например, вложенный Scaffold в модальном окне). Рекомендуется использовать этот паттерн для всех новых форм в проекте.
- `features/contractors/` — модуль контрагентов. Реализует список, просмотр, создание и редактирование контрагентов. Форма вынесена в отдельный stateless-виджет (`ContractorFormContent`), для модального окна используется stateful-обёртка (`ContractorFormScreen`). Модальные окна на десктопе ограничены по ширине и центрированы (Center + SizedBox), стиль унифицирован с сотрудниками и объектами. Код чистый, без дублирования и неиспользуемых функций.
- `features/contracts/` — модуль договоров. Реализует ContractsListScreen с мастер-детейл паттерном на десктопе (список + панель деталей) и полноэкранным просмотром на мобильных устройствах. Для добавления/редактирования договора используется showModalBottomSheet с DraggableScrollableSheet, на десктопе окно центрируется и ограничивается по ширине (Align + ConstrainedBox). Контент формы вынесен в отдельный stateless-виджет (`ContractFormModal`). Поиск реализован с разным UX для desktop (всегда видим) и mobile (pull-to-refresh). Для статуса договора используется AppBadge в правом верхнем углу карточки. Все стили и размеры берутся из ThemeData, поддерживается строгий минимализм и адаптивность. Работа с состоянием — через Riverpod StateNotifier. Код унифицирован с другими модулями по паттерну модальных окон и форм.

### Core

Общие компоненты, используемые во всем приложении:

- `core/common/` - общие утилиты и константы
- `core/di/` - внедрение зависимостей (providers.dart)
- `core/utils/` - вспомогательные функции

## Потоки данных

1. **UI (Presentation)** → Запрос данных или действие пользователя
2. **State Notifier** → Управление состоянием 
3. **UseCase** → Бизнес-логика
4. **Repository** → Абстракция доступа к данным
5. **DataSource** → Конкретная реализация доступа (Supabase)

## Система внедрения зависимостей

- Базируется на Riverpod
- Централизована в `core/di/providers.dart`
- Обеспечивает принцип инверсии зависимостей

## Принципы расширения архитектуры

1. Новая функциональность добавляется в папку `features/`
2. Бизнес-сущности и интерфейсы создаются в `domain/`
3. Реализации репозиториев и источников данных - в `data/`
4. Общие компоненты UI - в `presentation/widgets/`
5. Управление состоянием - через StateNotifier и провайдеры Riverpod 