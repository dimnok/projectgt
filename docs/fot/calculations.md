# –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ –º–æ–¥—É–ª—è –§–û–¢

**–î–∞—Ç–∞:** 07 —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞

## üöÄ Hybrid —Ä–∞—Å—á–µ—Ç –§–û–¢

–ú–æ–¥—É–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—É—é —Å—Ö–µ–º—É –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

### 1. –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–∞—Å—á–µ—Ç (PostgreSQL RPC)
–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ `calculate_payroll_for_month`.
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ç—ã—Å—è—á –∑–∞–ø–∏—Å–µ–π `work_hours` –∏ `employee_rates` –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.
- **–õ–æ–≥–∏–∫–∞:**
    - –û–±—ä–µ–¥–∏–Ω—è–µ—Ç `work_hours` (–∏–∑ –∑–∞–∫—Ä—ã—Ç—ã—Ö —Å–º–µ–Ω) –∏ `employee_attendance`.
    - –ü–æ–¥–±–∏—Ä–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —á–∞—Å–æ–≤—É—é —Å—Ç–∞–≤–∫—É –∏–∑ `employee_rates` –¥–ª—è –∫–∞–∂–¥–æ–π –¥–∞—Ç—ã.
    - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—É—Ç–æ—á–Ω—ã–µ —á–µ—Ä–µ–∑ `business_trip_rates` (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ -> –æ–±—â–∞—è —Å—Ç–∞–≤–∫–∞ –æ–±—ä–µ–∫—Ç–∞).
    - –°—É–º–º–∏—Ä—É–µ—Ç –ø—Ä–µ–º–∏–∏ –∏ —à—Ç—Ä–∞—Ñ—ã –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.

### 2. –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç (Dart Fallback)
–ï—Å–ª–∏ RPC-–≤—ã–∑–æ–≤ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –æ—à–∏–±–∫–æ–π, –ø—Ä–æ–≤–∞–π–¥–µ—Ä `filteredPayrollsProvider` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Ç–æ–¥ `_calculatePayrollClientSide`.
- –í—ã–ø–æ–ª–Ω—è–µ—Ç —Ç—É –∂–µ –ª–æ–≥–∏–∫—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –º–æ–¥—É–ª—è –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –ë–î.

## üí∞ –ê–ª–≥–æ—Ä–∏—Ç–º FIFO –¥–ª—è –≤—ã–ø–ª–∞—Ç
–í—ã–ø–ª–∞—Ç—ã –≤ —Å–∏—Å—Ç–µ–º–µ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∂–µ—Å—Ç–∫–æ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–µ—Å—è—Ü—É –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–≤ —Ç–∞–±–ª–∏—Ü–µ `payroll_payout` –µ—Å—Ç—å `payout_date`, –Ω–æ –Ω–µ—Ç `period_month`).

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–ª–æ–Ω–∫–∏ "–í—ã–ø–ª–∞—Ç—ã" –≤ —Ç–∞–±–ª–∏—Ü–µ –§–û–¢ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Å–∫–≤–æ–∑–Ω–æ–π FIFO (First In, First Out)**:
1.  **–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥**: –°–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è —Å—É–º–º–∞ –≤—Å–µ—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –¥–æ 1 —è–Ω–≤–∞—Ä—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞ (—á–µ—Ä–µ–∑ RPC `calculate_employee_balances_before_date`).
2.  **–ì–∞—à–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ**: –í—Å–µ –≤—ã–ø–ª–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ) —Å–Ω–∞—á–∞–ª–∞ –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ —ç—Ç–æ–≥–æ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞.
3.  **–¢–µ–∫—É—â–∏–π –≥–æ–¥**: –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–≥–∞—à–µ–Ω, –æ—Å—Ç–∞—Ç–æ–∫ –≤—ã–ø–ª–∞—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ –º–µ—Å—è—Ü–∞–º (1-12) –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞.
4.  **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ**: –í —Ç–∞–±–ª–∏—Ü–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—É–º–º–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –Ω–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–¥–æ–ª–∂–µ–Ω–Ω–æ—Å—Ç–µ–π.

## üìä –†–∞—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞
–ë–∞–ª–∞–Ω—Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ RPC `calculate_employee_balances()`.
- **–§–æ—Ä–º—É–ª–∞:** `Total Accrued - Total Paid`.
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —Ä–∞–±–æ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.
- –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–µ—à–∏—Ä—É–µ—Ç—Å—è –≤ `cachedEmployeeBalanceProvider` –Ω–∞ 5 –º–∏–Ω—É—Ç.

