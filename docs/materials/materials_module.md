# –ú–æ–¥—É–ª—å –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (Materials)
**–î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 18 —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞ (–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–º–µ—Ç–µ –∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è)

---

## –í–∞–∂–Ω–æ–µ –∑–∞–º–µ—á–∞–Ω–∏–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞–Ω–Ω—ã—Ö

> **–í–Ω–∏–º–∞–Ω–∏–µ:**
> - –ú–æ–¥—É–ª—å –≤–ª–∞–¥–µ–µ—Ç **4 —Ç–∞–±–ª–∏—Ü–∞–º–∏**: `materials`, `receipts`, `material_aliases`, `kit_components`
> - **–ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–¥–µ—Ä–∂–∞—Ç `company_id` –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (RLS).
> - **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –≥–∏–±—Ä–∏–¥–Ω–∞—è ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö + –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–º–µ—Ç–∞–º —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã
> - **UI-—Å—Ç–∞–Ω–¥–∞—Ä—Ç**: –ï–¥–∏–Ω—ã–π —ç–∫—Ä–∞–Ω `MaterialScreen` —Å —Ç—Ä–µ–º—è —Ä–µ–∂–∏–º–∞–º–∏ (–ú-15, –°–≤–æ–¥–Ω–æ, –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ).
> - **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ —á–µ—Ä–µ–∑ `GtFormatters` (`formatCurrency`, `formatRuDate`, `formatQuantity`).
> - **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: 
>   - `companies` ‚Äî –≤–ª–∞–¥–µ–ª–µ—Ü –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –º–æ–¥—É–ª—è
>   - `estimates` (—Å–º–µ—Ç—ã) ‚Äî –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–º –ø–æ–∑–∏—Ü–∏—è–º
>   - `contractors` (–∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã) ‚Äî –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
>   - `work_items` (–ø–æ–∑–∏—Ü–∏–∏ —Ä–∞–±–æ—Ç) ‚Äî –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
> - **–ú–µ—Ç–æ–¥ —Å–ø–∏—Å–∞–Ω–∏—è**: FIFO (First In, First Out) **–≤ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏—Ö –µ–¥–∏–Ω–∏—Ü–∞—Ö —Å–º–µ—Ç—ã** —Å —É—á–µ—Ç–æ–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ (multiplier).
> - **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è `v_materials_with_usage` –∏ `v_materials_grouped_by_estimate` –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.

---

## –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è

–ú–æ–¥—É–ª—å **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã** ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É—á—ë—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ –º–µ—Ç–æ–¥—É FIFO (First In, First Out). 

### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω –º–æ–¥—É–ª—å

–ú–æ–¥—É–ª—å —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É **—Å–∫–≤–æ–∑–Ω–æ–≥–æ —É—á—ë—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –æ—Ç –ø–æ—Å—Ç–∞–≤–∫–∏ –¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è**:
- –ò–º–ø–æ—Ä—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö –∏–∑ Excel/CSV –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
- –ü—Ä–∏–≤—è–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö –∫ —Å–º–µ—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º (—á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã)
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
- –†–∞—Å—á—ë—Ç –æ—Å—Ç–∞—Ç–∫–æ–≤ –ø–æ –º–µ—Ç–æ–¥—É FIFO —Å —É—á—ë—Ç–æ–º –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –∫–æ–º–ø–∞–Ω–∏–∏
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (–ø–æ –Ω–æ–º–µ—Ä—É, –¥–∞—Ç–µ, –¥–æ–≥–æ–≤–æ—Ä—É –∏ –∫–æ–º–ø–∞–Ω–∏–∏)
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–º–µ—Ç–µ**: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å —Å–≤–æ–¥–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –ø–æ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–º –ø–æ–∑–∏—Ü–∏—è–º (–≤—Å–µ ¬´–õ–æ—Ç–∫–∏¬ª —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ).

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **–ò–º–ø–æ—Ä—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ Excel/CSV, –ø–∞—Ä—Å–∏–Ω–≥, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ `company_id`
2. **–ú–∞–ø–ø–∏–Ω–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏–π –∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö –∫ —Å–º–µ—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º —á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å—ã
3. **–ì—Ä—É–ø–ø–æ–≤–æ–π –≤–∏–¥ (Canonical)** ‚Äî –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–∞—Ä—Ç–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø–æ–¥ –µ–¥–∏–Ω—ã–º —Å–º–µ—Ç–Ω—ã–º –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º.
4. **FIFO-—Å–ø–∏—Å–∞–Ω–∏–µ —Å –º—É–ª—å—Ç–∏–ø–ª–∏–∫–∞—Ç–æ—Ä–∞–º–∏** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —à—Ç—É–∫ –≤ –º–µ—Ç—Ä—ã (–∏ –¥—Ä—É–≥–∏–µ –µ–¥. –∏–∑–º.) –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏.
5. **–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** ‚Äî –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º, –¥–æ–≥–æ–≤–æ—Ä–∞–º, –∞ —Ç–∞–∫–∂–µ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ò–∑–æ–ª—è—Ü–∏—è Multi-tenancy**: –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–¥–µ–ª–µ–Ω—ã —á–µ—Ä–µ–∑ RLS.
- **FIFO —Å –ø–µ—Ä–µ—Å—á–µ—Ç–æ–º**: —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö —Å–º–µ—Ç—ã. –ï—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–∏—à–µ–ª –≤ —à—Ç—É–∫–∞—Ö (1 —à—Ç = 3 –º), —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–ø–∏—à–µ—Ç –º–µ—Ç—Ä—ã –∏–∑ —ç—Ç–∏—Ö —à—Ç—É–∫.
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏ –æ—Å—Ç–∞—Ç–∫–∏ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ SQL Views –Ω–∞ –ª–µ—Ç—É.
- **–ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `AnimatedSwitcher` –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É M-15, –°–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ–π –∏ –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º.

---

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –º–æ–¥—É–ª—è

1. **`materials`** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (–≤–ª–∞–¥–µ–ª–µ—Ü: –∫–æ–º–ø–∞–Ω–∏—è)
2. **`receipts`** ‚Äî —Ä–µ–µ—Å—Ç—Ä –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (–≤–ª–∞–¥–µ–ª–µ—Ü: –∫–æ–º–ø–∞–Ω–∏—è)
3. **`material_aliases`** ‚Äî –∞–ª–∏–∞—Å—ã –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫ —Å–º–µ—Ç–∞–º (–≤–ª–∞–¥–µ–ª–µ—Ü: –∫–æ–º–ø–∞–Ω–∏—è). –°–æ–¥–µ—Ä–∂–∏—Ç `multiplier_to_estimate`.
4. **`kit_components`** ‚Äî —Å–æ—Å—Ç–∞–≤ –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤ (BOM) –¥–ª—è —Å–º–µ—Ç–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π (–≤–ª–∞–¥–µ–ª–µ—Ü: –∫–æ–º–ø–∞–Ω–∏—è)

### –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Views)

1. **`v_materials_with_usage`** ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å —Ä–∞—Å—á–µ—Ç–æ–º FIFO –∏ –æ—Å—Ç–∞—Ç–∫–æ–≤.
2. **`v_materials_grouped_by_estimate`** ‚Äî —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ —Å–º–µ—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ñ–∞–π–ª—ã –º–æ–¥—É–ª—è

### Presentation/UI (—ç–∫—Ä–∞–Ω—ã, –≤–∏–¥–∂–µ—Ç—ã, –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã)

**–≠–∫—Ä–∞–Ω—ã:**
- `material_screen.dart` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —ç–∫—Ä–∞–Ω –º–æ–¥—É–ª—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤.

**–í–∏–¥–∂–µ—Ç—ã:**
- `materials_table_view.dart` ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–µ–µ—Å—Ç—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–ú-15).
- `materials_grouped_table_view.dart` ‚Äî —Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ —Å–º–µ—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º.
- `materials_mapping_body.dart` ‚Äî –æ–±–µ—Ä—Ç–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
- `materials_mapping_table_view.dart` ‚Äî –∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
- `materials_link_button.dart` ‚Äî –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–º–µ—Ç–µ.
- `material_from_receipts_picker.dart` ‚Äî **[–ù–û–í–û–ï]** –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `features/estimates`).

**–ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã (Riverpod):**
- `materials_providers.dart` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç `isMaterialsGroupedProvider`, `materialsGroupedListProvider` –∏ `linkedMaterialsProvider`.
- `materials_pager.dart` ‚Äî –ø–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–µ—Å—Ç—Ä–∞ (M-15).

### Domain (—Å—É—â–Ω–æ—Å—Ç–∏, use cases)

- `material_item.dart` ‚Äî –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å.

### Data (–º–æ–¥–µ–ª–∏, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, data sources)

**–ú–æ–¥–µ–ª–∏:**
- `material_item.dart` ‚Äî –º–æ–¥–µ–ª—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞.
- `grouped_material_item.dart` ‚Äî **[–ù–û–í–û–ï]** –º–æ–¥–µ–ª—å —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞.

**–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:**
- `materials_repository.dart` ‚Äî –º–µ—Ç–æ–¥—ã `fetchAll`, `fetchGrouped` –∏ `fetchLinkedMaterials`.

---

## –î–µ—Ä–µ–≤–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –º–æ–¥—É–ª—è

```
lib/features/materials/
‚îú‚îÄ‚îÄ presentation/
‚îÇ   ‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ material_screen.dart
‚îÇ   ‚îú‚îÄ‚îÄ widgets/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_table_view.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_grouped_table_view.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_mapping_body.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_mapping_table_view.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_link_button.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_import_action.dart
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ materials_mapping_action.dart
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ contracts_filter_chips.dart
‚îÇ   ‚îî‚îÄ‚îÄ providers/
‚îÇ       ‚îú‚îÄ‚îÄ materials_providers.dart
‚îÇ       ‚îú‚îÄ‚îÄ materials_pager.dart
‚îÇ       ‚îî‚îÄ‚îÄ materials_mapping_providers.dart
‚îî‚îÄ‚îÄ data/
    ‚îú‚îÄ‚îÄ models/
    ‚îÇ   ‚îú‚îÄ‚îÄ material_item.dart
    ‚îÇ   ‚îú‚îÄ‚îÄ grouped_material_item.dart
    ‚îÇ   ‚îî‚îÄ‚îÄ similar_estimate.dart
    ‚îú‚îÄ‚îÄ repositories/
    ‚îÇ   ‚îú‚îÄ‚îÄ materials_repository.dart
    ‚îÇ   ‚îî‚îÄ‚îÄ materials_import_repository.dart
    ‚îî‚îÄ‚îÄ parsers/
        ‚îî‚îÄ‚îÄ receipts_remote_parser.dart
```

---

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Multi-tenancy Audit)

### 1. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `v_materials_with_usage`
**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Ç 17.01.2026:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `multiplier` –∏–∑ –∞–ª–∏–∞—Å–æ–≤.
- –õ–æ–≥–∏–∫–∞ FIFO –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ "–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –µ–¥–∏–Ω–∏—Ü—ã" (quantity * multiplier).
- –°–ø–∏—Å–∞–Ω–∏–µ `used` –∏ –æ—Å—Ç–∞—Ç–æ–∫ `remaining` —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É—á–∏—Ç—ã–≤–∞—é—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –ø–µ—Ä–µ–≤–æ–¥–∞.

### 2. –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ `v_materials_grouped_by_estimate`
**[–ù–û–í–û–ï]**
- –ì—Ä—É–ø–ø–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ `estimate_id`.
- –ê–≥—Ä–µ–≥–∏—Ä—É–µ—Ç: `total_incoming`, `total_used`, `total_remaining` (–≤—Å–µ –≤ –µ–¥–∏–Ω–∏—Ü–∞—Ö —Å–º–µ—Ç—ã).
- –°—á–∏—Ç–∞–µ—Ç `batch_count` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—Å—Ç—Ä–µ—Ç–∏–ª—Å—è —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª).

---

## –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ (–û–±–Ω–æ–≤–ª–µ–Ω–æ 17.01.2026)
–í –º–æ–¥—É–ª–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞:
1. **Material M-15**: –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö.
2. **Materials Grouped (–°–≤–æ–¥–Ω–æ)**: –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∏–¥ –ø–æ —Å–º–µ—Ç–µ. –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–æ–π ¬´–°–ª–æ–∏¬ª –≤ AppBar.
3. **Material Mapping**: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

### –ê–ª–≥–æ—Ä–∏—Ç–º FIFO —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞–º–∏
–ï—Å–ª–∏ –º–∞—Ç–µ—Ä–∏–∞–ª –≤ –Ω–∞–∫–ª–∞–¥–Ω–æ–π —É–∫–∞–∑–∞–Ω –≤ "—à—Ç—É–∫–∞—Ö", –∞ –≤ —Å–º–µ—Ç–µ –≤ "–º–µ—Ç—Ä–∞—Ö" (—á–µ—Ä–µ–∑ –∞–ª–∏–∞—Å –∑–∞–¥–∞–Ω `multiplier = 3.0`):
1. –°–∏—Å—Ç–µ–º–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç `canonical_qty = quantity * 3.0`.
2. –ù–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –∏—Ç–æ–≥ –ø—Ä–∏—Ö–æ–¥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤ –º–µ—Ç—Ä–∞—Ö.
3. –°–ø–∏—Å–∞–Ω–∏–µ –∏–∑ `work_items` (–∫–æ—Ç–æ—Ä–æ–µ –≤—Å–µ–≥–¥–∞ –≤ –º–µ—Ç—Ä–∞—Ö) –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ —ç—Ç–æ–≥–æ –∏—Ç–æ–≥–∞.
4. –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç `used` –∏ `remaining` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ "—à—Ç—É–∫–∏" –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ M-15, –ª–∏–±–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –º–µ—Ç—Ä–∞—Ö –¥–ª—è —Å–≤–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã.

### –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–º–µ—Ç–µ (Smart Binding)
–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `MaterialFromReceiptsPicker` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞:
1. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞**: –£–∂–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ –¥–∞–Ω–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤–≤–µ—Ä—Ö—É —Å–ø–∏—Å–∫–∞.
2. **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è**: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –µ–¥. –∏–∑–º. —Å–º–µ—Ç—ã –∏ –Ω–∞–∫–ª–∞–¥–Ω–æ–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤, —Ç–æ—á–µ–∫ –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –ª–æ–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è ¬´—à—Ç¬ª, ¬´–®–¢.¬ª, ¬´—à—Ç ¬ª.
3. **–°—Ç–∞—Ç–∏—á–Ω—ã–π UI**: –í –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö –ø—Ä–∏–≤—è–∑–∫–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —Å–ª–æ–∂–Ω—ã–µ Slivers –≤ –ø–æ–ª—å–∑—É —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ `Column` + `ListView`. –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å –º–∞–ª—ã–º —ç–∫—Ä–∞–Ω–æ–º.
4. **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä**: –í—ã–±–æ—Ä —Å—Ç—Ä–æ–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ç—Ä–∏–≥–≥–µ—Ä (toggle) –ø–æ –≤—Å–µ–π –æ–±–ª–∞—Å—Ç–∏ —Å—Ç—Ä–æ–∫–∏ (`HitTestBehavior.opaque`).

---

## –ü–ª–∞–Ω —Ä–∞–∑–≤–∏—Ç–∏—è (Roadmap)

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ ‚úÖ
- ‚úÖ –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ —Å–º–µ—Ç–Ω—ã–º –ø–æ–∑–∏—Ü–∏—è–º (–°–≤–æ–¥–Ω—ã–π –≤–∏–¥).
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç FIFO –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (multiplier support).
- ‚úÖ –ë–µ—Å—à–æ–≤–Ω–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É M-15, –°–≤–æ–¥–Ω–æ –∏ Mapping.
- ‚úÖ –£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∏–≤—è–∑–∫–µ.
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–π UI –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏–≤—è–∑–∫–∏ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä—ã–≤–∫–æ–≤.

### –í –ø–ª–∞–Ω–∞—Ö üîÑ
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∞–ª–∏–∞—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞—Ä—Ç–∏–∫—É–ª–æ–≤.
- üîÑ –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ—Å—á–µ—Ç–∞.

---

**–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è:** 18 —è–Ω–≤–∞—Ä—è 2026 –≥–æ–¥–∞
