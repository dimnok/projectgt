# üìä –û–¢–ß–Å–¢: –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –í–´–ì–†–£–ó–ö–ò –í EXCEL

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 9 –æ–∫—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞  
**–ú–æ–¥—É–ª—å:** –í—ã–≥—Ä—É–∑–∫–∞ (Export)  
**–í–µ—Ä—Å–∏—è:** v1.0

---

## üéØ –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–æ–¥—É–ª–µ

**–ú–æ–¥—É–ª—å "–í—ã–≥—Ä—É–∑–∫–∞" (Export)** –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —Ä–∞–±–æ—Ç–∞–º –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel —Å –≥–∏–±–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ü—É—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:** `/export`  
**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** Clean Architecture (Domain ‚Üí Data ‚Üí Presentation)  
**–û—Å–Ω–æ–≤–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `excel: ^4.0.6`

---

## üìã –ü–†–û–¶–ï–°–° –í–´–ì–†–£–ó–ö–ò –í EXCEL

### **–®–∞–≥ 1: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞—ë—Ç —Ñ–∏–ª—å—Ç—Ä—ã —á–µ—Ä–µ–∑ UI:

#### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- **–ü–µ—Ä–∏–æ–¥ (dateFrom - dateTo)** ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω —Å–º–µ–Ω

#### **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä):**
- **–û–±—ä–µ–∫—Ç—ã** (`objectIds: List<String>`) ‚Äî —Å–ø–∏—Å–æ–∫ ID –æ–±—ä–µ–∫—Ç–æ–≤
- **–î–æ–≥–æ–≤–æ—Ä—ã** (`contractIds: List<String>`) ‚Äî —Å–ø–∏—Å–æ–∫ ID –¥–æ–≥–æ–≤–æ—Ä–æ–≤  
- **–°–∏—Å—Ç–µ–º—ã** (`systems: List<String>`) ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π —Å–∏—Å—Ç–µ–º
- **–ü–æ–¥—Å–∏—Å—Ç–µ–º—ã** (`subsystems: List<String>`) ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –ø–æ–¥—Å–∏—Å—Ç–µ–º

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:** `ExportFilter` (domain entity)

**–§–∞–π–ª:** `lib/features/export/domain/entities/export_filter.dart`

---

### **–®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î**

**–ò—Å—Ç–æ—á–Ω–∏–∫:** `ExportDataSourceImpl.getExportData()`

**–§–∞–π–ª:** `lib/features/export/data/datasources/export_data_source_impl.dart`

#### **SQL-–∑–∞–ø—Ä–æ—Å –∫ Supabase:**
```sql
SELECT 
  works.date,
  objects.name,
  work_items.system, subsystem, name, section, floor, unit, quantity, price, total,
  estimates.number,
  contracts.number
FROM works
INNER JOIN objects ON works.object_id = objects.id
INNER JOIN work_items ON work_items.work_id = works.id
INNER JOIN estimates ON work_items.estimate_id = estimates.id
INNER JOIN contracts ON estimates.contract_id = contracts.id
WHERE date >= dateFrom AND date <= dateTo
  AND (object_id IN objectIds OR objectIds –ø—É—Å—Ç–æ–π)
  AND (work_items.estimates.contracts.id IN contractIds OR contractIds –ø—É—Å—Ç–æ–π)
  AND (work_items.system IN systems OR systems –ø—É—Å—Ç–æ–π)
  AND (work_items.subsystem IN subsystems OR subsystems –ø—É—Å—Ç–æ–π)
ORDER BY date
```

#### **–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `works` ‚Äî —Å–º–µ–Ω—ã
- `objects` ‚Äî –æ–±—ä–µ–∫—Ç—ã —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞
- `work_items` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç—ã
- `estimates` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ —Å–º–µ—Ç—ã
- `contracts` ‚Äî –¥–æ–≥–æ–≤–æ—Ä—ã

---

### **–®–∞–≥ 3: –ü–ï–†–í–ò–ß–ù–ê–Ø –ì–†–£–ü–ü–ò–†–û–í–ö–ê (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è, –≤ Data Source)**

**üìå –í–ê–ñ–ù–û:** –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î!

**–§–∞–π–ª:** `lib/features/export/data/datasources/export_data_source_impl.dart` (—Å—Ç—Ä–æ–∫–∏ 118-156)

#### **–ö–ª—é—á –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**

```dart
final groupKey = 
  '${objectName}_'           // –û–±—ä–µ–∫—Ç
  '${contractName}_'         // –î–æ–≥–æ–≤–æ—Ä
  '${system}_'               // –°–∏—Å—Ç–µ–º–∞
  '${subsystem}_'            // –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
  '${positionNumber}_'       // ‚Ññ –ø–æ–∑–∏—Ü–∏–∏ —Å–º–µ—Ç—ã
  '${workName}_'             // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
  '${section}_'              // –£—á–∞—Å—Ç–æ–∫ (—Å–µ–∫—Ü–∏—è)
  '${floor}_'                // –≠—Ç–∞–∂
  '${unit}_'                 // –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
  '${price ?? 0}';           // –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
```

**‚≠ê –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢:** –î–∞—Ç–∞ **–ù–ï –≤—Ö–æ–¥–∏—Ç** –≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É! 

–ó–∞–ø–∏—Å–∏ —Å **–†–ê–ó–ù–´–• –î–ê–¢**, –Ω–æ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ **–û–ë–™–ï–î–ò–ù–Ø–Æ–¢–°–Ø**.

#### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∫–ª—é—á–∞:**
- ‚úÖ **–°—É–º–º–∏—Ä—É–µ—Ç—Å—è:** `quantity` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ)
- ‚úÖ **–ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:** `total = quantity * price` (–µ—Å–ª–∏ price –Ω–µ null)
- ‚ùå **–ù–ï –∏–∑–º–µ–Ω—è–µ—Ç—Å—è:** –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–æ–±—ä–µ–∫—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å–∏—Å—Ç–µ–º–∞ –∏ —Ç.–¥.)

#### **–ü—Ä–∏–º–µ—Ä 1: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å –æ–¥–Ω–æ–π –¥–∞—Ç—ã**
```
–ò—Å—Ö–æ–¥–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î:
1. –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –î–æ–≥–æ–≤–æ—Ä: "–î-123", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", 
   –°–µ–∫—Ü–∏—è: "–ê", –≠—Ç–∞–∂: "1", –ï–¥.–∏–∑–º: "–º", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 5, –¶–µ–Ω–∞: 100 ‚ÇΩ
2. –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –î–æ–≥–æ–≤–æ—Ä: "–î-123", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", 
   –°–µ–∫—Ü–∏—è: "–ê", –≠—Ç–∞–∂: "1", –ï–¥.–∏–∑–º: "–º", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 3, –¶–µ–Ω–∞: 100 ‚ÇΩ

‚Üí –ü–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:
   –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –î–æ–≥–æ–≤–æ—Ä: "–î-123", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", 
   –°–µ–∫—Ü–∏—è: "–ê", –≠—Ç–∞–∂: "1", –ï–¥.–∏–∑–º: "–º", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 8, –¶–µ–Ω–∞: 100 ‚ÇΩ, –°—É–º–º–∞: 800 ‚ÇΩ
```

#### **–ü—Ä–∏–º–µ—Ä 2: –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç** ‚≠ê –ù–û–í–û–ï
```
–ò—Å—Ö–æ–¥–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ë–î:
1. –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–¶–û–î –î—É–±–Ω–∞", –î–æ–≥–æ–≤–æ—Ä: "173-—Å—É6-25", –°–∏—Å—Ç–µ–º–∞: "–≠–û1",
   –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞: "–ü—Ä–æ—Ö–æ–¥–∫–∏", –ü–æ–∑–∏—Ü–∏—è: "108", –†–∞–±–æ—Ç–∞: "–ì–∏–ª—å–∑–∞ –∑–∞–∫–ª–∞–¥–Ω–∞—è",
   –°–µ–∫—Ü–∏—è: "–ê–ë–ö", –≠—Ç–∞–∂: "-1", –ï–¥.–∏–∑–º: "–º.", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1, –¶–µ–Ω–∞: ‚Äî
2. –î–∞—Ç–∞: 02.10.2024, –û–±—ä–µ–∫—Ç: "–¶–û–î –î—É–±–Ω–∞", –î–æ–≥–æ–≤–æ—Ä: "173-—Å—É6-25", –°–∏—Å—Ç–µ–º–∞: "–≠–û1",
   –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞: "–ü—Ä–æ—Ö–æ–¥–∫–∏", –ü–æ–∑–∏—Ü–∏—è: "108", –†–∞–±–æ—Ç–∞: "–ì–∏–ª—å–∑–∞ –∑–∞–∫–ª–∞–¥–Ω–∞—è",
   –°–µ–∫—Ü–∏—è: "–ê–ë–ö", –≠—Ç–∞–∂: "-1", –ï–¥.–∏–∑–º: "–º.", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1, –¶–µ–Ω–∞: ‚Äî

‚Üí –ü–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (–¥–∞—Ç—ã –†–ê–ó–ù–´–ï, –Ω–æ –æ—Å—Ç–∞–ª—å–Ω–æ–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ):
   –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–¶–û–î –î—É–±–Ω–∞", –î–æ–≥–æ–≤–æ—Ä: "173-—Å—É6-25", –°–∏—Å—Ç–µ–º–∞: "–≠–û1",
   –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞: "–ü—Ä–æ—Ö–æ–¥–∫–∏", –ü–æ–∑–∏—Ü–∏—è: "108", –†–∞–±–æ—Ç–∞: "–ì–∏–ª—å–∑–∞ –∑–∞–∫–ª–∞–¥–Ω–∞—è",
   –°–µ–∫—Ü–∏—è: "–ê–ë–ö", –≠—Ç–∞–∂: "-1", –ï–¥.–∏–∑–º: "–º.", –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: 2
   
   ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –¥–∞—Ç—ã!
```

#### **–ö–æ–¥ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**
```dart
if (groupedReports.containsKey(groupKey)) {
  // –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å —Å —Ç–∞–∫–∏–º –∫–ª—é—á–æ–º —É–∂–µ –µ—Å—Ç—å, —Å—É–º–º–∏—Ä—É–µ–º quantity
  final existing = groupedReports[groupKey]!;
  final newQuantity = existing.quantity + report.quantity;
  final newTotal = report.price != null ? newQuantity * report.price! : null;
  
  groupedReports[groupKey] = existing.copyWith(
    quantity: newQuantity,
    total: newTotal,
  );
} else {
  // –ï—Å–ª–∏ –∑–∞–ø–∏—Å–∏ —Å —Ç–∞–∫–∏–º –∫–ª—é—á–æ–º –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é
  groupedReports[groupKey] = report;
}
```

---

### **–®–∞–≥ 4: –î–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞**

**–í–∏–¥–∂–µ—Ç:** `ExportExcelAction` ‚Äî –∫–Ω–æ–ø–∫–∞ –≤ AppBar (–∏–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏)

**–§–∞–π–ª:** `lib/features/export/presentation/widgets/export_excel_action.dart`

#### **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –¥–∏–∞–ª–æ–≥–µ:**

1. **–í—ã–±–æ—Ä –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞** (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä):
   - ‚úÖ –û–±—ä–µ–∫—Ç
   - ‚úÖ –î–æ–≥–æ–≤–æ—Ä
   - ‚úÖ –°–∏—Å—Ç–µ–º–∞
   - ‚úÖ –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
   - ‚úÖ –£—á–∞—Å—Ç–æ–∫
   - ‚úÖ –≠—Ç–∞–∂
   - ‚úÖ ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
   - ‚úÖ –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
   - ‚úÖ –ï–¥. –∏–∑–º.
   - ‚úÖ –ö–æ–ª-–≤–æ
   - ‚úÖ –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É
   - ‚úÖ –°—É–º–º–∞

2. **–û–ø—Ü–∏—è "–û–±—ä–µ–¥–∏–Ω—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏"** (`aggregate: bool`)
   - –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ ‚Üí –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ç–æ—Ä–∏—á–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è
   - –ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–∞ ‚Üí —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏

#### **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫:**
```dart
SharedPreferences:
  - 'export_columns_v1' ‚Üí —Å–ø–∏—Å–æ–∫ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
  - 'export_aggregate_v1' ‚Üí —Ñ–ª–∞–≥ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏
```

---

### **–®–∞–≥ 5: –í–¢–û–†–ò–ß–ù–ê–Ø –ê–ì–†–ï–ì–ê–¶–ò–Ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è, –≤ Export Service)**

**–ï—Å–ª–∏ `aggregate = true`**, –¥–∞–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è –≤ `ExportService.exportToExcel()`.

**–§–∞–π–ª:** `lib/features/export/presentation/services/export_service.dart` (—Å—Ç—Ä–æ–∫–∏ 139-187)

**üìå –ö–õ–Æ–ß–ï–í–û–ï –û–¢–õ–ò–ß–ò–ï:** –í—Ç–æ—Ä–∏—á–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–µ–Ω—å—à–µ –ø–æ–ª–µ–π** –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏!

#### **–ö–ª—é—á –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**

```dart
final key = [
  report.objectName,        // –û–±—ä–µ–∫—Ç
  report.contractName,      // –î–æ–≥–æ–≤–æ—Ä
  report.system,            // –°–∏—Å—Ç–µ–º–∞
  report.subsystem,         // –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
  report.positionNumber,    // ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
  report.workName,          // –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
].join('||');
```

#### **‚ö†Ô∏è –í–ê–ñ–ù–û:** –ü—Ä–∏ –≤—Ç–æ—Ä–∏—á–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ **–ù–ï —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:**
- ‚ùå –î–∞—Ç–∞ —Å–º–µ–Ω—ã
- ‚ùå –°–µ–∫—Ü–∏—è
- ‚ùå –≠—Ç–∞–∂
- ‚ùå –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
- ‚ùå –¶–µ–Ω–∞ (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

#### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∫–ª—é—á–∞:**

1. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:** —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è
   ```dart
   current.quantitySum += report.quantity.toDouble();
   ```

2. **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è:** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
   ```dart
   if (current.unitConsistent != report.unit) {
     current.unitConsistent = null; // –ï—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
   }
   ```

3. **–¶–µ–Ω–∞:** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
   ```dart
   if (current.priceConsistent != report.price) {
     current.priceConsistent = null; // –ï—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ ‚Äî —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è
   }
   ```

4. **–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:**
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: `quantity * price`
   - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –Ω–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ ‚Üí –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è: `sum(total)`

   ```dart
   final double? computedTotal = consistentPrice != null
       ? (entry.quantitySum * consistentPrice)
       : entry.totalSum;
   ```

#### **–ü—Ä–∏–º–µ—Ä –≤—Ç–æ—Ä–∏—á–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
```
–î–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–∏—á–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:
1. –î–∞—Ç–∞: 01.10.2024, –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", –°–µ–∫—Ü–∏—è: "–ê", –ö–æ–ª-–≤–æ: 5, –¶–µ–Ω–∞: 100 ‚ÇΩ
2. –î–∞—Ç–∞: 02.10.2024, –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", –°–µ–∫—Ü–∏—è: "–ë", –ö–æ–ª-–≤–æ: 3, –¶–µ–Ω–∞: 100 ‚ÇΩ

‚Üí –ü–æ—Å–ª–µ –≤—Ç–æ—Ä–∏—á–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ (aggregate=true):
   –û–±—ä–µ–∫—Ç: "–î–æ–º 1", –†–∞–±–æ—Ç–∞: "–ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±", –ö–æ–ª-–≤–æ: 8, –¶–µ–Ω–∞: 100 ‚ÇΩ, –°—É–º–º–∞: 800 ‚ÇΩ
   (–î–∞—Ç–∞, –°–µ–∫—Ü–∏—è, –≠—Ç–∞–∂ ‚Äî –Ω–µ –≤—ã–≤–æ–¥—è—Ç—Å—è)
```

#### **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –º–æ–¥–µ–ª—å –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
```dart
class _AggregatedEntry {
  final String objectName;
  final String contractName;
  final String system;
  final String subsystem;
  final String positionNumber;
  final String workName;
  String? unitConsistent;      // null –µ—Å–ª–∏ –µ–¥–∏–Ω–∏—Ü—ã —Ä–∞–∑–Ω—ã–µ
  double quantitySum;           // –°—É–º–º–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤
  double? priceConsistent;      // null –µ—Å–ª–∏ —Ü–µ–Ω—ã —Ä–∞–∑–Ω—ã–µ
  double? totalSum;             // –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —Å—É–º–º–∞
}
```

---

### **–®–∞–≥ 6: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Excel-—Ñ–∞–π–ª–∞**

**–°–µ—Ä–≤–∏—Å:** `ExportService.exportToExcel()`

**–§–∞–π–ª:** `lib/features/export/presentation/services/export_service.dart`

#### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞:**

1. **–ò–º—è –ª–∏—Å—Ç–∞:**
   - –ï—Å–ª–∏ –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç: `<–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞> <DD.MM.YYYY>`
   - –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤: `–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç <DD.MM.YYYY>`
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: –¥–æ 31 —Å–∏–º–≤–æ–ª–∞, –±–µ–∑ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ `\ / * ? [ ]`

2. **–ó–∞–≥–æ–ª–æ–≤–∫–∏:**
   - –°—Ç–∏–ª—å: –∂–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç (`bold: true`), 12pt, —á–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç
   - –ö–æ–ª–æ–Ω–∫–∏: —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –≤ –¥–∏–∞–ª–æ–≥–µ
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
     ```dart
     final headerStyle = CellStyle(
       bold: true,
       fontSize: 12,
       fontColorHex: ExcelColor.black,
     );
     cell.value = TextCellValue(title);
     cell.cellStyle = headerStyle;
     ```

3. **–î–∞–Ω–Ω—ã–µ:**
   - –°—Ç–∏–ª—å: –æ–±—ã—á–Ω—ã–π —à—Ä–∏—Ñ—Ç, 11pt
   - –¢–∏–ø—ã —è—á–µ–µ–∫:
     - –¢–µ–∫—Å—Ç ‚Üí `TextCellValue`
     - –ß–∏—Å–ª–∞ ‚Üí `DoubleCellValue`
   - –î–∞—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ `dd.MM.yyyy`
   - –ü—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Üí `TextCellValue('')`

4. **–ê–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã:**
   ```dart
   for (int i = 0; i < selectedColumns.length; i++) {
     sheet.setColumnAutoFit(i);
   }
   ```

#### **–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Excel:**

| –û–±—ä–µ–∫—Ç | –î–æ–≥–æ–≤–æ—Ä | –°–∏—Å—Ç–µ–º–∞ | –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ | –£—á–∞—Å—Ç–æ–∫ | –≠—Ç–∞–∂ | ‚Ññ –ø–æ–∑–∏—Ü–∏–∏ | –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã | –ï–¥. –∏–∑–º. | –ö–æ–ª-–≤–æ | –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É | –°—É–º–º–∞ |
|--------|---------|---------|------------|---------|------|-----------|---------------------|----------|--------|-----------------|-------|
| –¶–û–î –î—É–±–Ω–∞ | 173-—Å—É6-25 | –≠–û1 | –ü—Ä–æ—Ö–æ–¥–∫–∏ | –ê–ë–ö | -1 | 108 | –ì–∏–ª—å–∑–∞ –∑–∞–∫–ª–∞–¥–Ω–∞—è | –º. | 2 | ‚Äî | ‚Äî |
| –î–æ–º 1  | –î-123   | –í–ö      | –ö–∞–Ω–∞–ª–∏–∑–∞—Ü–∏—è| –ê      | 1    | 1.2.3     | –ú–æ–Ω—Ç–∞–∂ —Ç—Ä—É–±         | –º | 8.0 | 100.0 | 800.0 |
| –î–æ–º 2  | –î-456   | –û–í      | –û—Ç–æ–ø–ª–µ–Ω–∏–µ  | –ë      | 2    | 2.3.4     | –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–¥–∏–∞—Ç–æ—Ä–æ–≤| —à—Ç | 5.0 | 2500.0 | 12500.0 |

---

### **–®–∞–≥ 7: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞**

**–ò–º—è —Ñ–∞–π–ª–∞:** `<–û–±—ä–µ–∫—Ç> <DD.MM.YYYY>.xlsx`

**–ü—Ä–∏–º–µ—Ä—ã:**
- –û–¥–∏–Ω –æ–±—ä–µ–∫—Ç: `–î–æ–º 1 09.10.2024.xlsx`
- –ù–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤: `–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç 09.10.2024.xlsx`

#### **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:**

**Web:**
```dart
await FileSaver.instance.saveFile(
  name: outputFile,
  bytes: Uint8List.fromList(bytes),
  mimeType: MimeType.microsoftExcel,
);
```
- –§–∞–π–ª —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

**–ú–æ–±–∏–ª—å–Ω—ã–µ/–î–µ—Å–∫—Ç–æ–ø:**
```dart
final directory = await getApplicationDocumentsDirectory();
final file = File('${directory.path}/$outputFile');
await file.writeAsBytes(bytes);
```
- –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ **–£—Å–ø–µ—Ö:** SnackBar –∑–µ–ª—ë–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å –ø—É—Ç—ë–º –∫ —Ñ–∞–π–ª—É
- ‚ùå **–û—à–∏–±–∫–∞:** SnackBar –∫—Ä–∞—Å–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å —Ç–µ–∫—Å—Ç–æ–º –æ—à–∏–±–∫–∏

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –ì–†–£–ü–ü–ò–†–û–í–û–ö

| –ü–∞—Ä–∞–º–µ—Ç—Ä –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ | –ü–µ—Ä–≤–∏—á–Ω–∞—è (Data Source) | –í—Ç–æ—Ä–∏—á–Ω–∞—è (Export Service) |
|---------------------|-------------------------|----------------------------|
| **–ö–æ–≥–¥–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç** | –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î (—Å—Ç—Ä–æ–∫–∏ 117-156) | –ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ, –µ—Å–ª–∏ `aggregate=true` (—Å—Ç—Ä–æ–∫–∏ 139-187) |
| **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ –í—Å–µ–≥–¥–∞ | ‚ö†Ô∏è –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ –≤—ã–±–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) |
| **–î–∞—Ç–∞ —Å–º–µ–Ω—ã** | ‚ùå –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–û–±—ä–µ–∫—Ç** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–î–æ–≥–æ–≤–æ—Ä** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–°–∏—Å—Ç–µ–º–∞** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–ü–æ–¥—Å–∏—Å—Ç–µ–º–∞** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **‚Ññ –ø–æ–∑–∏—Ü–∏–∏** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–†–∞–±–æ—Ç–∞** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–°–µ–∫—Ü–∏—è (–£—á–∞—Å—Ç–æ–∫)** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–≠—Ç–∞–∂** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ùå –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |
| **–ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º.** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (null –µ—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ) |
| **–¶–µ–Ω–∞** | ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è | ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (null –µ—Å–ª–∏ —Ä–∞–∑–Ω—ã–µ) |

**–ß—Ç–æ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è:**
- ‚úÖ `quantity` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ) ‚Äî –≤—Å–µ–≥–¥–∞ –≤ –æ–±–µ–∏—Ö –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞—Ö
- ‚úÖ `total` (–∏—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞) ‚Äî –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–ª–∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è

**–ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ:**
- **–ü–µ—Ä–≤–∏—á–Ω–∞—è:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç, –Ω–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–µ–∫—Ü–∏—é –∏ —ç—Ç–∞–∂
- **–í—Ç–æ—Ä–∏—á–Ω–∞—è:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –∑–∞–ø–∏—Å–∏, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –∏ –¥–∞—Ç—É, –∏ —Å–µ–∫—Ü–∏—é, –∏ —ç—Ç–∞–∂

---

## üîÑ –ü–û–õ–ù–´–ô –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –î–ê–ù–ù–´–•

```
1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Supabase PostgreSQL)
   ‚Üì –¢–∞–±–ª–∏—Ü—ã: works, objects, work_items, estimates, contracts
   ‚Üì
2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è SQL
   ‚Üì WHERE date, object_id, contract_id, system, subsystem
   ‚Üì
3. –ü–ï–†–í–ò–ß–ù–ê–Ø –ì–†–£–ü–ü–ò–†–û–í–ö–ê (ExportDataSourceImpl)
   ‚Üì –ö–ª—é—á: 11 –ø–æ–ª–µ–π (–¥–∞—Ç–∞, –æ–±—ä–µ–∫—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å–∏—Å—Ç–µ–º–∞, –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞, –ø–æ–∑–∏—Ü–∏—è, —Ä–∞–±–æ—Ç–∞, —Å–µ–∫—Ü–∏—è, —ç—Ç–∞–∂, –µ–¥.–∏–∑–º., —Ü–µ–Ω–∞)
   ‚Üì –î–µ–π—Å—Ç–≤–∏–µ: —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π
   ‚Üì
4. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ domain entities (ExportReport)
   ‚Üì Repository ‚Üí Notifier ‚Üí State
   ‚Üì
5. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ UI (ExportTableWidget)
   ‚Üì PlutoGrid —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
   ‚Üì
6. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–≠–∫—Å–ø–æ—Ä—Ç –≤ Excel" (ExportExcelAction)
   ‚Üì
7. –î–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫ + –æ–ø—Ü–∏—è "–û–±—ä–µ–¥–∏–Ω—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏"
   ‚Üì –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –≤ SharedPreferences
   ‚Üì
8. –í–¢–û–†–ò–ß–ù–ê–Ø –ê–ì–†–ï–ì–ê–¶–ò–Ø (–µ—Å–ª–∏ aggregate=true)
   ‚Üì –ö–ª—é—á: 6 –ø–æ–ª–µ–π (–æ–±—ä–µ–∫—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å–∏—Å—Ç–µ–º–∞, –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞, –ø–æ–∑–∏—Ü–∏—è, —Ä–∞–±–æ—Ç–∞)
   ‚Üì –î–µ–π—Å—Ç–≤–∏–µ: —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞, –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ü–µ–Ω—ã –∏ –µ–¥.–∏–∑–º.
   ‚Üì
9. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Excel (ExportService)
   ‚Üì –ó–∞–≥–æ–ª–æ–≤–∫–∏ + –¥–∞–Ω–Ω—ã–µ + —Å—Ç–∏–ª–∏ + –∞–≤—Ç–æ–ø–æ–¥–±–æ—Ä —à–∏—Ä–∏–Ω—ã
   ‚Üì
10. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
    ‚Üì Web: –±—Ä–∞—É–∑–µ—Ä | –ú–æ–±–∏–ª—å–Ω—ã–π: –ø–∞–ø–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ‚Üì
11. SnackBar —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (—É—Å–ø–µ—Ö/–æ—à–∏–±–∫–∞)
```

---

## üéØ –ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´

### **1. –î–≤–µ —Å—Ç–∞–¥–∏–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**

#### **–ü–µ—Ä–≤–∏—á–Ω–∞—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è):**
- **–ì–¥–µ:** `ExportDataSourceImpl.getExportData()`
- **–ö–æ–≥–¥–∞:** –°—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ –ë–î
- **–¶–µ–ª—å:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ 10 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (–±–µ–∑ —É—á—ë—Ç–∞ –¥–∞—Ç—ã)
- **–ö–ª—é—á:** 10 –ø–æ–ª–µ–π (–æ–±—ä–µ–∫—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å–∏—Å—Ç–µ–º–∞, –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞, –ø–æ–∑–∏—Ü–∏—è, —Ä–∞–±–æ—Ç–∞, —Å–µ–∫—Ü–∏—è, —ç—Ç–∞–∂, –µ–¥.–∏–∑–º., —Ü–µ–Ω–∞)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç

#### **–í—Ç–æ—Ä–∏—á–Ω–∞—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è):**
- **–ì–¥–µ:** `ExportService.exportToExcel()`
- **–ö–æ–≥–¥–∞:** –ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏–ª –æ–ø—Ü–∏—é
- **–¶–µ–ª—å:** –ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ —Ä–∞–±–æ—Ç–∞–º –±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å–µ–∫—Ü–∏—è–º/—ç—Ç–∞–∂–∞–º
- **–ö–ª—é—á:** 6 –ø–æ–ª–µ–π (–æ–±—ä–µ–∫—Ç, –¥–æ–≥–æ–≤–æ—Ä, —Å–∏—Å—Ç–µ–º–∞, –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞, –ø–æ–∑–∏—Ü–∏—è, —Ä–∞–±–æ—Ç–∞)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç –∑–∞ –≤–µ—Å—å –ø–µ—Ä–∏–æ–¥ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–µ–π)

### **2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è:**

**–ü–µ—Ä–≤–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (10 –ø–æ–ª–µ–π):**
1. –û–±—ä–µ–∫—Ç
2. –î–æ–≥–æ–≤–æ—Ä
3. –°–∏—Å—Ç–µ–º–∞
4. –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
5. ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
6. –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
7. –£—á–∞—Å—Ç–æ–∫ (—Å–µ–∫—Ü–∏—è)
8. –≠—Ç–∞–∂
9. –ï–¥–∏–Ω–∏—Ü–∞ –∏–∑–º–µ—Ä–µ–Ω–∏—è
10. –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É

**‚≠ê –î–∞—Ç–∞ –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è!** –ó–∞–ø–∏—Å–∏ —Å —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è, –µ—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç –æ—Å—Ç–∞–ª—å–Ω—ã–µ 10 –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

**–í—Ç–æ—Ä–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ (6 –ø–æ–ª–µ–π):**
1. –û–±—ä–µ–∫—Ç
2. –î–æ–≥–æ–≤–æ—Ä
3. –°–∏—Å—Ç–µ–º–∞
4. –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞
5. ‚Ññ –ø–æ–∑–∏—Ü–∏–∏
6. –ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

### **3. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**

**–ü—Ä–∏ –≤—Ç–æ—Ä–∏—á–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
- –ï—Å–ª–∏ **—Ü–µ–Ω—ã —Ä–∞–∑–Ω—ã–µ** –≤ –æ–±—ä–µ–¥–∏–Ω—è–µ–º—ã—Ö –∑–∞–ø–∏—Å—è—Ö ‚Üí —Ü–µ–Ω–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `null`
- –ï—Å–ª–∏ **–µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è —Ä–∞–∑–Ω—ã–µ** ‚Üí –µ–¥–∏–Ω–∏—Ü–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Å–µ–≥–¥–∞ —Å—É–º–º–∏—Ä—É–µ—Ç—Å—è**
- **–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:**
  - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ ‚Üí –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: `quantity * price`
  - –ï—Å–ª–∏ —Ü–µ–Ω–∞ –Ω–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ ‚Üí –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è: `sum(total)`

### **4. –ì–∏–±–∫–æ—Å—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–∞:**

- ‚úÖ **–í—ã–±–æ—Ä –∫–æ–ª–æ–Ω–æ–∫** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∞–º —Ä–µ—à–∞–µ—Ç, —á—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫** ‚Äî —á–µ—Ä–µ–∑ `SharedPreferences`
- ‚úÖ **–î–≤–∞ —Ä–µ–∂–∏–º–∞:**
  - **–î–µ—Ç–∞–ª—å–Ω—ã–π** (aggregate=false): —Å –¥–∞—Ç–∞–º–∏, —Å–µ–∫—Ü–∏—è–º–∏, —ç—Ç–∞–∂–∞–º–∏
  - **–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–π** (aggregate=true): —Ç–æ–ª—å–∫–æ –ø–æ —Ä–∞–±–æ—Ç–∞–º (—Å–≤–æ–¥–Ω—ã–π –æ—Ç—á—ë—Ç)
- ‚úÖ **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî Web/iOS/Android/Desktop

### **5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- **Clean Architecture** ‚Äî —á—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ (Domain, Data, Presentation)
- **Immutability** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Freezed –¥–ª—è domain entities
- **State Management** ‚Äî Riverpod (StateNotifier)
- **Dependency Injection** ‚Äî —á–µ—Ä–µ–∑ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã Riverpod
- **–û—Ç–¥–µ–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏** ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ Data Source, –∞–≥—Ä–µ–≥–∞—Ü–∏—è –≤ Service

---

## üìÅ –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –º–æ–¥—É–ª—è

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `lib/features/export/domain/entities/export_filter.dart` | –°—É—â–Ω–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞ (–ø–µ—Ä–∏–æ–¥ + —Å–ø–∏—Å–∫–∏ –æ–±—ä–µ–∫—Ç–æ–≤/–¥–æ–≥–æ–≤–æ—Ä–æ–≤/—Å–∏—Å—Ç–µ–º) |
| `lib/features/export/domain/entities/export_report.dart` | –°—É—â–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∫–∏ –æ—Ç—á—ë—Ç–∞ |
| `lib/features/export/data/datasources/export_data_source_impl.dart` | **–ü–µ—Ä–≤–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** + SQL –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase |
| `lib/features/export/presentation/services/export_service.dart` | **–í—Ç–æ—Ä–∏—á–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è** + —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–∞ |
| `lib/features/export/presentation/widgets/export_excel_action.dart` | –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ + –¥–∏–∞–ª–æ–≥ –Ω–∞—Å—Ç—Ä–æ–µ–∫ |
| `lib/features/export/presentation/providers/export_provider.dart` | State management (Riverpod) |
| `lib/features/export/presentation/screens/export_screen.dart` | –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω –º–æ–¥—É–ª—è |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –ü–∞–∫–µ—Ç | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|--------|-----------|
| `excel` | ^4.0.6 | –°–æ–∑–¥–∞–Ω–∏–µ Excel —Ñ–∞–π–ª–æ–≤ |
| `file_saver` | ‚Äî | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ Web |
| `path_provider` | ‚Äî | –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—É—Ç–∏ –∫ –ø–∞–ø–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ |
| `supabase_flutter` | ‚Äî | –†–∞–±–æ—Ç–∞ —Å –ë–î |
| `riverpod` | ‚Äî | State management |
| `freezed` | ‚Äî | Immutable entities |
| `shared_preferences` | ‚Äî | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞ |

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –æ–±–∞ –º–µ—Å—Ç–∞:
   - `ExportDataSourceImpl.getExportData()` (–ø–µ—Ä–≤–∏—á–Ω–∞—è)
   - `ExportService.exportToExcel()` (–≤—Ç–æ—Ä–∏—á–Ω–∞—è)

2. **–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫:**
   - –û–±–Ω–æ–≤–∏—Ç—å `ExportReport` entity
   - –û–±–Ω–æ–≤–∏—Ç—å `availableColumns` –≤ `ExportExcelAction`
   - –û–±–Ω–æ–≤–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤ `ExportService` (switch cases)

3. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:**
   - –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ —Ä–µ–∂–∏–º–∞ (aggregate=true/false)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ü–µ–Ω –∏ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –ü–µ—Ä–≤–∏—á–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è UI
   - –í—Ç–æ—Ä–∏—á–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —É–∂–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `inFilter()` –≤ SQL –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã

---

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏:** 9 –æ–∫—Ç—è–±—Ä—è 2025 –≥–æ–¥–∞  
**–ê–≤—Ç–æ—Ä –æ—Ç—á—ë—Ç–∞:** AI Assistant (Cursor)  
**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç—É–∞–ª—å–Ω–æ


