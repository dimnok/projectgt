# Экран "Финансовая информация"

Описание функциональности экрана финансовой информации в профиле пользователя.

## Назначение
- Отображать агрегированные показатели по привязанному сотруднику за выбранный месяц и за весь период:
  - текущий месяц: отработанные часы, база (часы*ставка), суточные, премии, штрафы, итого к выплате;
  - итоги за весь период: общая сумма заработанного, общая сумма выплат, общий остаток.
- Предоставлять детализацию:
  - модальное окно со списком премий/штрафов (дата, сумма, причина `reason`);
  - модальный календарь по дням с суммой отработанных часов.

## UI и навигация
- Путь: кнопка "Финансовая информация" на `ProfileScreen` → маршрут `/profile/financial` (`profile_financial`).
- Заголовок: AppBarWidget с кнопкой "Назад".
- Переключение месяцев: кнопки "Пред." и "След." в шапке экрана.
- Карточки:
  - "Текущий период" — с плашкой месяца и метриками; строки "Премии" и "Штрафы" кликабельны.
  - "Итоги" — агрегаты по всему периоду; строка "Общая сумма выплат" кликабельна.
- Детализация:
  - При клике на "Премии"/"Штрафы" — модальное окно со списком (дата, сумма, `reason`).
  - При клике на "Отработанные часы" — модальный календарь с суммами по дням.
  - При клике на "Общая сумма выплат" — модалка со списком выплат и переключением месяцев.

## Источники данных
- Таблицы:
  - `work_hours` (join `works(date, object_id)`, `employees(hourly_rate)`)
  - `objects(business_trip_amount)` — суточные
  - `payroll_bonus(amount, date, created_at, reason)`
  - `payroll_penalty(amount, date, reason)`
  - `payroll_payout(amount, payout_date, comment)`
- Привязка к пользователю через `profiles.employee_id`.

## Техническая реализация
- Файл: `features/profile/presentation/screens/financial_info_screen.dart`.
- Провайдер: `_financialInfoProvider(args)` с параметрами `employeeId` и `monthStart`.
  - Рассчитывает:
    - за месяц: `hours`, `hourlyRate`, `baseSalary`, `businessTripTotal`, `bonuses`, `penalties`, `netSalary`;
    - итоги: `totalEarned = base + bonuses + trips - penalties`, `totalPayouts`, `totalBalance`;
    - детализация: `monthBonusRecords`, `monthPenaltyRecords`, `monthHoursByDate`, `allPayoutRecords`.
- UI:
  - Цвета положительных — `primary`, штрафов — `error`.
  - Акцент для итоговых значений.
  - Календарь на модалке — адаптивный `GridView` с динамическим `childAspectRatio` для мобильных.
  - Модалка выплат — локальный месяц + фильтрация записей по месяцу (стрелки навигации).

## Тест-кейсы
1. Без привязки `employee_id` — текст-подсказка о необходимости привязать сотрудника.
2. С привязкой — корректные значения за текущий месяц, переключение на прошлый/следующий месяц.
3. Клики по "Премии"/"Штрафы" — открывается модалка со списком (дата, сумма, `reason`).
4. Клик по "Отработанные часы" — календарь с суммами по дням.
5. Клик по "Общая сумма выплат" — модалка с выплатами; стрелками менять месяц (фильтруется перечень выплат). Комментарий берётся из `comment`.

## Примечания
- Web: не использовать `dart:io Platform.*` — guard через `kIsWeb` в коде уведомлений (несвязанная проблема).
- RLS: доступ к таблицам должен соответствовать действующим политикам проекта.
