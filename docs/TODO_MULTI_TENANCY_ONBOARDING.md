# План внедрения Multi-tenancy Onboarding (Экран выбора компании)

Этот план описывает пошаговый процесс реализации логики выбора между созданием новой компании и вступлением в существующую после успешной авторизации.

**Важное правило:** После каждого выполненного этапа я предоставляю краткий отчет (2-3 структурированных предложения) и ожидаю вашего подтверждения для перехода к следующему шагу.

---

## Этап 1: Аудит и подготовка базы данных
- [x] Проверить структуру таблиц `companies` и `company_members`.
- [x] Убедиться в наличии необходимых индексов для быстрого поиска по `invitation_code` и `user_id`.
- [x] Подготовить SQL-запрос для проверки наличия членства пользователя в компаниях.

## Этап 2: Создание визуального интерфейса (UI) Onboarding
- [x] Создать новый экран `OnboardingScreen` в папке `lib/features/auth/presentation/screens/`.
- [x] Реализовать дизайн с двумя основными карточками-выборами: "Создать свою организацию" и "Вступить по коду".
- [x] Обеспечить адаптивность экрана для мобильных устройств и десктопа.

## Этап 3: Обновление логики состояния (Auth State)
- [x] Добавить статус `AuthStatus.onboarding` в перечисление статусов авторизации.
- [x] Модифицировать `AuthNotifier`: после успешного ввода OTP кода добавить проверку в `company_members`.
- [x] Если связей с компаниями нет — переводить состояние в `AuthStatus.onboarding`.

## Этап 4: Реализация бизнес-логики создания и вступления (Use Cases)
- [x] Создать `CreateCompanyUseCase` для регистрации новой организации и назначения владельца.
- [x] Создать `JoinCompanyUseCase` для поиска компании по `invitation_code` и добавления участника.
- [x] Реализовать формы/диалоги для ввода названия компании и кода приглашения.

## Этап 5: Интеграция навигации (AuthGate)
- [x] Обновить основной компонент `AuthGate`, чтобы он распознавал статус `onboarding`.
- [x] Настроить роутинг: при статусе `onboarding` всегда показывать `OnboardingScreen`.
- [x] Протестировать цепочку: Вход -> Проверка -> Выбор пути -> Главный экран.

## Этап 6: Внутренний доступ и управление контекстом
- [x] Добавить в боковое меню кнопку "Добавить компанию", вызывающую интерфейс Onboarding.
- [x] Реализовать механизм переключения между активными компаниями в AppDrawer.
- [x] Обновить документацию модуля Multi-tenancy по итогам реализации.

