#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è Flutter –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ProjectGT
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./deploy.sh [platform]
# –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã: web (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), ios

PLATFORM=${1:-web}

if [ "$PLATFORM" = "ios" ]; then
    echo "üçé –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é –Ω–∞ iOS –¥–µ–ø–ª–æ–π..."
    ./deploy_ios.sh archive
    exit $?
fi

echo "üöÄ –ù–∞—á–∏–Ω–∞—é –ø—Ä–æ—Ü–µ—Å—Å –≤–µ–±-–¥–µ–ø–ª–æ—è –Ω–∞ Surge..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ Flutter
if ! command -v flutter &> /dev/null; then
    echo "‚ùå Flutter –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Flutter."
    exit 1
fi

# –î–ª—è –¥–µ–ø–ª–æ—è –∏—Å–ø–æ–ª—å–∑—É–µ–º npx —Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π surge
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ surge –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

echo "üî® –°–æ–∑–¥–∞—é –≤–µ–±-—Å–±–æ—Ä–∫—É..."
flutter build web --release

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ–±-—Å–±–æ—Ä–∫–∏"
    exit 1
fi

echo "‚òÅÔ∏è  –î–µ–ø–ª–æ—é –Ω–∞ Surge (–¥–æ–º–µ–Ω projectgt.surge.sh)..."
cd build/web && npx -y surge@0.23.0 . projectgt.surge.sh

if [ $? -eq 0 ]; then
    echo "‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à—ë–Ω!"
    echo "üåê –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–º Surge –¥–æ–º–µ–Ω–µ (—Å–º. –≤—ã–≤–æ–¥ –≤—ã—à–µ)"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ"
    exit 1
fi

echo "üéâ –ì–æ—Ç–æ–≤–æ!"