# Модуль Табель рабочего времени

## Описание
Модуль для отображения и управления табелем рабочего времени сотрудников.

## Структура
- `domain/` - доменные сущности и репозитории
- `data/` - источники данных и реализации репозиториев  
- `presentation/` - UI компоненты и провайдеры состояния

## Основные компоненты

### TimesheetCalendarView
Календарное представление табеля с отображением часов по дням и сотрудникам.

**Исправленные проблемы:**
- ✅ Добавлен `didUpdateWidget()` для корректного обновления диапазона дат при изменении месяца/года
- ✅ Вынесена логика построения диапазона дат в отдельный метод `_buildDateRange()`
- ✅ Исправлена проблема с отображением часов после переключения месяца

### TimesheetFilterWidget  
Виджет фильтрации с выбором периода, сотрудников, объектов и должностей.

**Исправленные проблемы:**
- ✅ Добавлен `didUpdateWidget()` для синхронизации контроллеров с состоянием
- ✅ Добавлен метод `_updateControllers()` для обновления значений полей
- ✅ Исправлена синхронизация полей года и месяца при программном изменении дат

### TimesheetDataSourceImpl
Источник данных для получения записей табеля из Supabase.

**Исправленные проблемы:**
- ✅ Исправлена логика фильтрации по `endDate` для корректного включения записей за последний день месяца
- ✅ Добавлена обработка времени до 23:59:59.999 для последнего дня диапазона
- ✅ Улучшена документация логики фильтрации дат

## Использование

```dart
// Основной экран табеля
TimesheetScreen()

// Календарное представление
TimesheetCalendarView(
  entries: entries,
  startDate: startDate, 
  endDate: endDate,
)

// Фильтры
TimesheetFilterWidget()
```

## Сборка

Для генерации кода выполните:
```bash
./build.sh
```

## Назначение

Модуль "Табель" позволяет:
- Просматривать часы сотрудников, отработанные на различных объектах
- Фильтровать данные по периоду времени, сотруднику и объекту
- Группировать данные по сотрудникам или по датам
- Отображать агрегированную информацию по часам

## Структура данных

Модуль работает с таблицей `work_hours` базы данных, которая используется также в модуле "Работы".

### Основные сущности:

- **TimesheetEntry** - запись в табеле (соответствует записи в таблице work_hours)
  - id - идентификатор записи
  - workId - идентификатор смены
  - employeeId - идентификатор сотрудника
  - hours - количество отработанных часов
  - date - дата смены (из таблицы works)
  - objectId - идентификатор объекта (из таблицы works)
  - comment - комментарий (опционально)
  - employeeName - имя сотрудника (не хранится в БД)
  - objectName - название объекта (не хранится в БД)
  - createdAt, updatedAt - время создания и обновления записи

- **TimesheetSummary** - агрегированная информация по часам сотрудника
  - employeeId - идентификатор сотрудника
  - employeeName - имя сотрудника
  - hoursByDate - часы по датам
  - hoursByObject - часы по объектам
  - totalHours - общее количество часов

## Архитектура

Модуль разработан в соответствии с принципами Clean Architecture и разделён на слои:

### Domain Layer
- Определяет основные сущности и интерфейсы репозиториев
- Содержит бизнес-логику модуля

### Data Layer
- Содержит реализации репозиториев
- Отвечает за получение и преобразование данных из API

### Presentation Layer
- Содержит UI-компоненты для отображения табеля
- Реализует фильтрацию и группировку данных
- Использует Riverpod для управления состоянием

## Особенности реализации

- Модуль использует адаптивный дизайн для работы как на десктопе, так и на мобильных устройствах
- Интегрируется с существующими модулями сотрудников (Employees) и объектов (Objects)
- Использует данные из модуля работ (Works) для получения информации о сменах

## Расширение функциональности

В будущем планируется добавить:
- Экспорт данных в Excel/CSV
- Печать табеля
- Редактирование часов непосредственно из табеля 